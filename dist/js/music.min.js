!function(t){function e(t,e){isNaN(e)&&(e=0),t=Math.floor(t),e=Math.floor(e);var s,n,i=e-t;return s=parseInt(i/60),n=i%60>=10?i%60:"0"+i%60,"-"+s+":"+n}function s(t,e){return t=Math.floor(t),e=Math.floor(e),(t/e*100).toFixed(2)}function n(t){t=t||{},this.url=t.url||"",this.playIndex=t.playIndex||1,this.playFlag=!1,this.list=[],this.elements={list:".js-playlist",cover:".js-cover",play:".js-play",prev:".js-prev",next:".js-next",name:".js-name",author:".js-author",time:".js-time",progress:".js-progress"},this.init()}var i=new Audio;n.prototype={init:function(){var t=this;this.getPlayList(function(){t.swich(),t.play(),t.bindEvent()})},getPlayList:function(t){var e=this;t=t||$.noop,$.ajax({url:this.url,type:"GET",cache:!1,dataType:"json"}).done(function(s){e.list=s,e.renderPlayList(s),t(s)}).fail(function(t){console.log(t),alert("网络错误！")})},renderPlayList:function(t){var e=$(this.elements.list),s=[];t.forEach(function(t,e){s.push("<li><span>"+t.name+" - "+t.author+"</span><time>"+t.duration+"</time></li>")}),e.html(s.join(""))},setPlayInfo:function(t){t-=1;var e=this,s=this.list[t];this.defaultCover=$(this.elements.cover).attr("src"),i.src=s.url,$(this.elements.name).text(s.name),$(this.elements.author).text(s.author),$(this.elements.list).find("li").removeClass("play").eq(t).addClass("play");var n=new Image;return n.onload=function(){$(e.elements.cover).attr("src",s.cover)},n.src=s.cover,this.watchPlayInfo(),this},watchPlayInfo:function(){var t=this;i.ontimeupdate=function(){var n=e(i.currentTime,i.duration);$(t.elements.time).text(n);var a=s(i.currentTime,i.duration);$(t.elements.progress).find("span").css("width",a+"%"),i.ended&&(t.resetPlayInfo(),$(t.elements.next).trigger("click"))},i.onprogress=function(){var e=0,s=this.buffered,n=this.currentTime;if(s.length>0){for(;!(s.start(e)<=n&&n<=s.end(e));)e+=1;var i=s.start(e)/this.duration,a=s.end(e)/this.duration,l=100*(a-i);$(t.elements.progress).find("i").css("width",l+"%")}}},resetPlayInfo:function(){return this.pause(),$(this.elements.cover).attr("src",this.defaultCover),$(this.elements.name).text("Music Player By Yuuk"),$(this.elements.author).text("Yuuk"),$(this.elements.progress).html("<i></i><span></span>"),$(this.elements.time).text("0:00"),this},swich:function(t){return t=t||this.playIndex,this.setPlayInfo(t),this.play(),this},play:function(){return i.play(),$(this.elements.play).addClass("pause").removeClass("play"),$(this.elements.cover).addClass("play"),this},pause:function(){return i.pause(),$(this.elements.play).addClass("play").removeClass("pause"),$(this.elements.cover).removeClass("play"),this},bindEvent:function(){var t=this;$(this.elements.play).on("click",function(){i.paused?t.play():t.pause()}),$(this.elements.prev).on("click",function(){t.playIndex>1?t.playIndex-=1:t.playIndex=t.list.length,t.resetPlayInfo().swich()}),$(this.elements.next).on("click",function(){t.playIndex<t.list.length?t.playIndex+=1:t.playIndex=1,t.resetPlayInfo().swich()}),$(this.elements.list).on("click","li",function(){var e=$(this),s=e.index();e.hasClass("play")||(t.playIndex=s+1,t.resetPlayInfo().swich())}),$(this.elements.progress).on("click",function(t){var e=$(this),s=(t.pageX-e.offset().left)/e.width(),n=i.duration;i.currentTime=n*s})}},t.musicPlayer=n}(window);